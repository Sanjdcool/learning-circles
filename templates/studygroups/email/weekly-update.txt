{% extends 'email_base.html' %}
{% load humanize %}
{% load i18n %}
{% block body %}

  {% if team %}
    {% blocktrans with team_name=team.name %} This week at {{ team_name }} {% endblocktrans %}
  {% else %}
    {% trans "Weekly learning circles update" %}
  {% endif %}


  {% blocktrans with start_date=start_time|date:"l, F j" %}For the week of {{start_date}}.{% endblocktrans %}
  {% url 'studygroups_weekly_report_date' start_time.year start_time.month start_time.day as report_url %}
  {% if email %}{% blocktrans %}You can also view this report online: {{PROTOCOL}}://{{DOMAIN}}{{report_url}}{% endblocktrans %}{% endif %}


  {% blocktrans count finished_studygroups_count=finished_studygroups_count %}
    {{ finished_studygroups_count }} learning circle wrapped up
  {% plural %}
    {{ finished_studygroups_count }} learning circles wrapped up
  {% endblocktrans %}


  {% if finished_studygroups_count > 0 %}
    {% for studygroup in finished_studygroups %}
      -----
      {% trans "Facilitator" %}: {{ studygroup.facilitator.first_name | title }}
      {% trans "Course" %}: {{ studygroup.course.title }}
      {% trans "Venue" %}: {{ studygroup.venue_name | title }}
      {% trans "Final report" %}: {{ studygroup.report_url }}
    {% endfor %}
  {% endif %}

  {% blocktrans count studygroups_met_count=studygroups_met_count %}
    {{ studygroups_met_count }} learning circle met,
  {% plural %}
    {{ studygroups_met_count }} learning circles met,
  {% endblocktrans %}
  {% blocktrans count learners_reached_count=learners_reached_count %}
    reaching {{ learners_reached_count }} learner
  {% plural %}
    reaching {{ learners_reached_count }} learners
  {% endblocktrans %}

  {% if meetings %}
    {% trans "Meetings this week" %}

    {% for meeting in meetings|dictsort:"meeting_datetime" %}
      {% with study_group=meeting.study_group %}
      {% blocktrans with meeting_date=meeting.meeting_datetime|date:"fA, l, M j" meeting_number=meeting.meeting_number course=study_group.course.title venue=study_group.venue_name first_name=study_group.facilitator.first_name last_name=study_group.facilitator.last_name email=study_group.facilitator.email meeting_count=study_group.meeting_set.active.count %}
        -----
        Facilitator: {{first_name}} {{last_name}}
        Course: {{course}}
        Venue: {{venue}}
        Meeting date: {{ meeting_date }}
        trans: {{meeting_number}} of {{meeting_count}}
      {% endblocktrans %}
      {% endwith %}
    {% endfor %}
  {% endif %}

  {% if feedback %}
    {% trans "Feedback from this week" %}
      {% for feedback_response in feedback %}
        {% with study_group=feedback_response.study_group_meeting.study_group %}
        {% blocktrans with course=study_group.course.title venue=study_group.venue_name first_name=study_group.facilitator.first_name last_name=study_group.facilitator.last_name email=study_group.facilitator.email %}
        -----
        &quot;{{course}}&quot; at {{venue}} facilitated by {{first_name}} {{last_name}}.{% endblocktrans %}
        {% endwith %}
        {% trans "Summary" %}: &quot;{{ feedback_response.feedback }}&quot;
        {% trans "Things worth sharing" %}: &quot;{{ feedback_response.reflection }}&quot;
        {% trans "How many people attended?" %}: {{ feedback_response.attendance }}
        {% trans "Overall rating" %}: {{ feedback_response.get_rating_display }}
    {% endfor %}
  {% endif %}


  {% blocktrans count upcoming_studygroups_count=upcoming_studygroups_count %}
    {{ upcoming_studygroups_count }} learning circle will begin in the next 3 weeks
  {% plural %}
    {{ upcoming_studygroups_count }} learning circles will begin in the next 3 weeks
  {% endblocktrans %}

  {% if upcoming_studygroups_count > 0 %}
    {% for studygroup in upcoming_studygroups %}
      -----
      {% trans "Facilitator" %}: {{ studygroup.facilitator.first_name | title }}
      {% trans "Course" %}: {{ studygroup.course.title }}
      {% trans "Venue" %}: {{ studygroup.venue_name | title }}
    {% endfor %}
  {% endif %}


  {% blocktrans count new_learners_count=new_learners_count %}
    {{ new_learners_count }} learner signed up for a learning circle
  {% plural %}
    {{ new_learners_count }} learners signed up for a learning circle
  {% endblocktrans %}

  {% blocktrans count new_users_count=new_users_count %}
    {{ new_users_count }} new team member joined
  {% plural %}
    {{ new_users_count }} new team members joined
  {% endblocktrans %}

  {% if new_users_count > 0 %}
    {% for user in new_users %}
      -----
      {% trans "Name" %}: {{ user.first_name | title }} {{ user.last_name | title }}
      {% trans "Email" %}: {{ user.email }}
    {% endfor %}
  {% endif %}

  {% if new_courses_count > 0 %}
    {% blocktrans count new_courses_count=new_courses_count %}
      {{ new_courses_count }} course was added to the P2PU database
    {% plural %}
      {{ new_courses_count }} courses were added to the P2PU database
    {% endblocktrans %}

    {% for course in new_courses %}
      - {{ course.created_by.first_name }} {% trans "added" %} {{ course.title }}
    {% endfor %}
  {% endif %}
  {% trans "To see all the courses, check out the courses page:" %} https://www.p2pu.org/en/courses/


{% endblock %}
